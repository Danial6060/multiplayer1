# TODO — multiplayer-fps

This file was generated by scanning the repository and comparing the codebase with the project objectives from `multiplayer-fps.md`.

Summary
-------
- Observations:
  - `server/` crate contains substantial server-side logic: `map` generator (`src/map/loader.rs`), `client` message handlers (`src/client/*`), shooting and movement logic, and player types.
  - `server/src/main.rs` is a stub and does not initialize networking/game loop.
  - There's no client application in the repo yet (no GUI/client binary to render the world or prompt for server IP/name).
  - `Cargo.toml` lists `bevy`, `bevy_renet`, `serde`, etc., so the stack is intended to use Bevy + Renet (UDP).

- Key gaps relative to `multiplayer-fps.md` objectives:
  - No client UI (mini-map, Maze-Wars style graphics, FPS counter) - ADDED(game_world.rs, maze.rs, minimap_and_fps.rs)
  - Server binary not implemented (network startup, connection handling).
  - No explicit level progression/round management for 3+ levels.
  - No obvious tests, CI, or performance validation.

Pending tasks (high level)
-------------------------


1) Implement server startup and networking (critical)
   - Replace the stub in `server/src/main.rs` with code that:
     - Initializes RenetServer (UDP) and configures channels.
     - Sets a reasonable `max_clients` (>= 10; suggest 32 for headroom).
     - Spawns the game loop / Bevy app or an equivalent event loop and registers systems that process incoming messages using the existing `client` handlers.
   - Files: `server/src/main.rs`, `server/src/lib.rs` (integration), `server/Cargo.toml` may need dependency tweaks.
<h2>((( Done )))</h2>
_____________
- Replaced the stub in server/src/main.rs with server::run_server(None, Some(32)).
Initialized a non-blocking UDP socket at 0.0.0.0:5000.
Created a RenetServer with default channels (ReliableOrdered, ReliableUnordered, Unreliable).
Configured NetcodeServerTransport with max_clients = 32 and ServerAuthentication::Unsecure.
Built a Bevy App as the main game loop.
Registered systems:
handle_server_events (connect/disconnect)
receive_client_messages (process JSON events: Move, Look, Shoot)
log_server_stats (print connected clients every second).
Integrated existing client-side handlers for movement and shooting logic.

▶️ 1-How to Run

Open terminal in the server directory:
cd server
cargo run

2- On first run (Windows), allow network access when prompted.
3- Optional: check that the UDP port is open:
netstat -ano | Select-String ":5000"

▶️ How to operate (currently with GNU toolchain)
$env:RUSTFLAGS='-C opt-level=0'
cargo run -j 1
_____________

2) Integrate message handling and connection auth (high)
   - Implement join flow: client sends server IP + username; server creates/assigns Player, returns initial `MapMessage` and `Players` list.
   - Handle disconnects and stale clients.
   - Ensure server listens on an externally reachable address and supports remote clients (not only localhost/loopback).
   - Files: `server/src/client/*`, `server/src/types.rs` (Games, Game), `server/src/player/*`.

3) Create client application (critical)
   - Build a Bevy-based client that:
     - Prompts for server IP and username (CLI + optional GUI connect dialog).
     - Connects via Renet/UDP and subscribes to server messages.
     - Renders walls/players, shows FPS counter and mini-map.
   - Provide a runnable demo client binary and README for usage.

4) Render mini-map and Maze-Wars style graphics (UI)
   - Implement styles that approximate the original Maze Wars visuals.
   - Mini-map should display the whole map plus own position and other players.

5) Implement levels and progression (requirements)
   - Add round lifecycle and at least 3 distinct levels with increasing difficulty.
   - Use `map/loader.rs` generator and expose API to request new level generation based on `MapSize` and `Difficulty` votes.
   - Files: `server/src/map/*`, `server/src/types.rs` (vote/start logic), new systems for round management.

6) Add bots / AI players (bonus)
   - Implement server-side bots that can navigate the map and shoot.
   - Use existing map graph (rooms and connections) for pathfinding.

7) Add level editor / procedural generator UI (bonus)
   - Either extend client with an editor or produce a separate tool to create/save maps.

8) Performance validation and optimization (must achieve >50 FPS)
   - Profile client render loop and server tick rate.
   - Add minimal performance tests/benchmarks and document how to measure FPS and repro steps.

9) Automated tests and integration tests
    - Unit tests for `map/loader.rs` (connectivity, dead-end count), `client::process_player_motion`, etc.
    - Integration test that spawns server and several headless clients to validate networking and multi-client behavior.

10) Docs, README and run instructions
    - Add a top-level `README.md` describing how to build and run server and client (WSL notes, Rust toolchain, ports to open).
    - Expand `server/README.md` with concrete run commands and networking notes.

11) CI / build verification
    - Add GitHub Actions to build server and client, run unit tests, and optionally run headless integration tests.

Implementation notes & priorities
--------------------------------
- Priority (critical): implement server startup & networking, and create a playable client (UI + networking). Without a client and server runtime, the project cannot meet the objectives.
- Priority (medium): level management, join/auth flow, and tests.
- Priority (low/bonus): bots, level editor, CI integration for headless performance checks.

Verification steps (how to mark a task done)
-------------------------------------------
- Server startup: `cargo run --manifest-path server/Cargo.toml` should start a server that prints listening IP/port and accepts Renet clients. Provide sample `netstat`/log showing socket bound.
- Client: running client binary should prompt for server IP and username, connect, and show the rendered maze + mini-map + FPS number.
- Levels: Start a server and cycle through at least three different generated maps/difficulties; verify map differences and difficulty-related dead-end counts.
- Multi-client: demonstrate 10 simultaneous local clients connecting and moving; automated integration test preferred.

Assumptions & next steps
-----------------------
- Assumed stack: Bevy + Renet (UDP) as declared in `server/Cargo.toml`.
- The server modules are reasonably implemented (map generator, movement/shooting handlers). The main missing piece is the bootstrap (startup and client app).

Recommended immediate next actions (short-term)
----------------------------------------------
1. Implement a working `server/src/main.rs` that boots RenetServer and accepts clients (this will let us iterate with a headless test client).
2. Add a minimal headless client (CLI) that can connect, send a join message and receive `MapMessage` — used for fast integration testing.
3. Create a Bevy client prototype that renders the map and shows FPS and a mini-map.

-- End of TODO
